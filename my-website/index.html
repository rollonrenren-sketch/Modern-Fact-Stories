<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <meta name="theme-color" content="#0f0f0f" />
  <title>Modern Fact Stories - Professional Streaming Platform</title>
  <link rel="icon" type="image/jpeg" href="logo.jpg" />

  <!-- Canonical + SEO -->
  <link rel="canonical" href="https://your-domain.example/" />
  <meta name="description" content="Watch trending movies and series. Fast player, clean UI, instant search." />
  <meta property="og:title" content="Modern Fact Stories" />
  <meta property="og:description" content="Trending movies & series. Fast player, instant search, resume where you left off." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://your-domain.example/" />
  <meta property="og:image" content="https://your-domain.example/logo.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"Modern Fact Stories",
    "url":"https://your-domain.example/",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://your-domain.example/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://api.themoviedb.org" crossorigin>
  <link rel="preconnect" href="https://image.tmdb.org" crossorigin>
  <link rel="dns-prefetch" href="//idolinflectiongentlemen.com">
  <link rel="preconnect" href="https://idolinflectiongentlemen.com" crossorigin>

  <!-- (Optional) Set CSP via Cloudflare headers, not meta, to avoid blocking vendor scripts. -->

  <!-- (Optional) Analytics (Plausible/GA). Replace domain as needed. -->
  <script defer data-domain="your-domain.example" src="https://plausible.io/js/script.js"></script>
  <script>function track(ev, data){ try{ window.plausible?.(ev,{props:data}); }catch{} }</script>

  <style>
    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CSS RESET (light) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    img{max-width:100%;display:block}
    button{font:inherit}
    :root{
      /* Base palette */
      --primary-bg:#ffffff; --secondary-bg:#f8f9fa; --card-bg:#ffffff;
      --accent-red:#e50914; --accent-blue:#0071eb; --accent-gold:#f5c518; --accent-green:#46d369;
      --text-primary:#1a1a1a; --text-secondary:#5a5a5a; --text-muted:#8c8c8c;
      --border-color:#e0e0e0; --hover-bg:#f5f5f5;
      --shadow-sm:0 2px 8px rgba(0,0,0,.08); --shadow-md:0 4px 16px rgba(0,0,0,.12); --shadow-lg:0 8px 32px rgba(0,0,0,.16);

      /* Layout scales */
      --container-pad: clamp(16px, 3vw, 40px);
      --section-gap: clamp(32px, 5vw, 50px);
      --radius-lg: 20px;

      /* Responsive movie card min width (overridden per breakpoint) */
      --card-min: 200px;

      /* Typography */
      --h1-size: clamp(28px, 4.5vw, 64px);
      --h2-size: clamp(20px, 2.2vw, 28px);
      --text-size: clamp(14px, 1.5vw, 16px);

      /* iOS safe area */
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    [data-theme="dark"]{
      --primary-bg:#0f0f0f; --secondary-bg:#1a1a1a; --card-bg:#222222;
      --text-primary:#ffffff; --text-secondary:#b3b3b3; --text-muted:#808080; --border-color:#333333; --hover-bg:#2a2a2a;
      --shadow-sm:0 2px 8px rgba(0,0,0,.4); --shadow-md:0 4px 16px rgba(0,0,0,.5); --shadow-lg:0 8px 32px rgba(0,0,0,.6);
    }

    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,system-ui,sans-serif;
      font-size:var(--text-size);
      background:var(--primary-bg);
      color:var(--text-primary);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Scrollbar */
    ::-webkit-scrollbar{width:10px;height:10px}
    ::-webkit-scrollbar-track{background:var(--secondary-bg)}
    ::-webkit-scrollbar-thumb{background:var(--accent-red);border-radius:10px}

    /* Loading (improved) */
    .loading-screen{
      position:fixed;inset:0;background:radial-gradient(1200px 1200px at 50% -10%, rgba(229,9,20,.25), transparent 60%),linear-gradient(135deg,#0f0f0f 0%,#1a1a1a 100%);
      display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;
      transition:opacity .5s ease,visibility .5s ease
    }
    .loading-screen.hidden{opacity:0;visibility:hidden}
    .loading-logo{width:96px;height:96px;margin-bottom:24px;border-radius:50%;box-shadow:0 0 30px rgba(229,9,20,.5)}
    .loading-ring{position:relative;width:72px;height:72px}
    .loading-ring::before,.loading-ring::after{
      content:"";position:absolute;inset:0;border-radius:50%;
      border:4px solid transparent;border-top-color:#e50914;animation:spin 1.1s linear infinite
    }
    .loading-ring::after{inset:8px;border-width:4px;border-bottom-color:#e50914;animation-duration:1.6s;opacity:.8}
    .loading-text{color:white;font-size:14px;margin-top:16px;font-weight:600;letter-spacing:.3px;opacity:.9}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* NAVBAR */
    .navbar{
      position:sticky;top:0;z-index:100;
      display:flex;align-items:center;justify-content:space-between;
      padding:12px var(--container-pad);
      background:var(--card-bg); border-bottom:1px solid var(--border-color);
      box-shadow:var(--shadow-sm);
      backdrop-filter:saturate(120%) blur(8px);
    }
    .navbar-left{display:flex;align-items:center;gap:18px}
    .logo{display:flex;align-items:center;gap:12px;cursor:pointer;text-decoration:none}
    .logo-img{width:40px;height:40px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px rgba(229,9,20,.3);transition:transform .3s}
    .logo-img:hover{transform:scale(1.06) rotate(3deg)}
    .logo-text{font-weight:800;background:linear-gradient(135deg,var(--accent-red),var(--accent-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

    .nav-links{display:flex;gap:14px}
    .nav-links a{color:var(--text-secondary);text-decoration:none;padding:8px 12px;border-radius:8px;transition:.25s;font-weight:600;white-space:nowrap}
    .nav-links a:hover,.nav-links a.active{background:var(--hover-bg);color:var(--text-primary)}

    .navbar-right{display:flex;align-items:center;gap:10px}
    .search-container{position:relative;display:flex;align-items:center}
    .search-bar{background:var(--secondary-bg);border:2px solid var(--border-color);color:var(--text-primary);padding:10px 40px 10px 14px;border-radius:999px;width:min(54vw,320px);transition:.25s}
    .search-bar:focus{outline:none;border-color:var(--accent-red);width:min(64vw,380px)}
    .search-clear{position:absolute;right:6px;background:var(--accent-red);color:white;border:none;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px;display:none;transition:transform .2s}
    .search-clear:hover{transform:scale(1.06)}
    .theme-toggle,.user-profile{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
    .theme-toggle{background:var(--secondary-bg);border:2px solid var(--border-color);font-size:18px}
    .theme-toggle:hover{transform:rotate(180deg)}
    .user-profile{background:linear-gradient(135deg,var(--accent-red),var(--accent-blue));color:#fff;font-weight:800}

    /* Hamburger */
    .nav-toggle{
      display:none;background:var(--secondary-bg);border:2px solid var(--border-color);
      width:40px;height:40px;border-radius:10px;align-items:center;justify-content:center;cursor:pointer;
    }
    .nav-toggle span{display:block;width:20px;height:2px;background:var(--text-primary);position:relative}
    .nav-toggle span::before,.nav-toggle span::after{content:"";position:absolute;left:0;width:20px;height:2px;background:var(--text-primary)}
    .nav-toggle span::before{top:-6px}.nav-toggle span::after{top:6px}

    /* HERO */
    .hero{position:relative;margin:0 0 var(--section-gap);padding:0 var(--container-pad)}
    .hero-inner{position:relative;border-radius:0 0 var(--radius-lg) var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-lg);isolation:isolate;background:#000}
    .hero-media{width:100%;aspect-ratio:16/9;background-position:center;background-size:cover;filter:saturate(110%) contrast(102%)}
    .hero-inner::before{content:"";position:absolute;inset:0;background:linear-gradient(to bottom, rgba(0,0,0,.15), rgba(0,0,0,.85));z-index:0}
    .hero-content{position:absolute;inset:auto 0 0 0;padding:clamp(16px,3vw,40px);color:#fff; z-index:1; max-width:min(900px,96%)}
    .hero-badge{display:inline-block;background:var(--accent-red);padding:6px 14px;border-radius:999px;font-size:12px;font-weight:800;margin-bottom:12px;text-transform:uppercase}
    .hero h1{font-size:var(--h1-size);line-height:1.05;margin:0 0 10px;text-shadow:2px 2px 20px rgba(0,0,0,.8);font-weight:900}
    .hero p{opacity:.95}
    .hero-buttons{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
    .btn{padding:12px 26px;border:none;border-radius:10px;font-weight:800;cursor:pointer;display:inline-flex;align-items:center;gap:10px;transition:transform .2s,background .2s}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--accent-red);color:#fff}
    .btn-primary:hover{background:#ff0a16}
    .btn-secondary{background:rgba(255,255,255,.25);color:#fff;backdrop-filter:blur(10px)}

    /* SECTIONS */
    .section{margin:var(--section-gap) var(--container-pad)}
    .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:14px}
    .section-title{font-size:var(--h2-size);font-weight:900}
    .movie-grid{
      display:grid;gap:clamp(12px,2vw,24px);
      grid-template-columns: repeat(auto-fill, minmax(var(--card-min), 1fr));
    }

    /* Skeleton card */
    .skeleton{border-radius:14px;overflow:hidden;background:var(--card-bg);box-shadow:var(--shadow-sm)}
    .skeleton .sk-poster{aspect-ratio:2/3;background:linear-gradient(90deg,#2a2a2a20, #2a2a2a40, #2a2a2a20);animation:shimmer 1.3s infinite}
    .skeleton .sk-text{height:46px;padding:10px}
    .skeleton .sk-bar{height:10px;border-radius:6px;background:linear-gradient(90deg,#2a2a2a20, #2a2a2a40, #2a2a2a20);animation:shimmer 1.3s infinite}
    @keyframes shimmer {0%{background-position:-200px 0}100%{background-position:200px 0}}
    @media (prefers-reduced-motion:reduce){.skeleton .sk-poster,.skeleton .sk-bar{animation:none}}

    /* Card */
    .movie-card{position:relative;cursor:pointer;transition:transform .2s, box-shadow .2s;background:var(--card-bg);border-radius:14px;overflow:hidden;box-shadow:var(--shadow-sm)}
    .movie-card:hover{transform:translateY(-6px);box-shadow:var(--shadow-lg)}
    .poster-wrap{position:relative;width:100%;aspect-ratio: 2 / 3;overflow:hidden;background:#111}
    .poster-wrap img.movie-poster{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block}
    .movie-info{padding:12px}
    .movie-title{font-size:15px;font-weight:800;margin-bottom:6px}
    .movie-progress{height:4px;background:rgba(0,0,0,.08);border-radius:2px;overflow:hidden;margin-top:8px}
    .movie-progress-bar{height:100%;background:var(--accent-red);transition:width .3s}
    .quality-badge{position:absolute;top:8px;left:8px;background:var(--accent-red);color:#fff;padding:4px 10px;border-radius:999px;font-size:10px;font-weight:900}
    .action-btn{position:absolute;top:8px;right:8px;background:rgba(0,0,0,.8);border:none;color:#fff;width:36px;height:36px;border-radius:50%;cursor:pointer;font-size:16px;opacity:0;transition:opacity .2s}
    .movie-card:hover .action-btn{opacity:1}
    .action-btn:hover,.action-btn.active{background:var(--accent-red)}
    .no-results{grid-column:1/-1;text-align:center;padding:60px 20px;color:var(--text-muted)}
    .no-results h3{font-size:1.2rem;margin-bottom:10px;color:var(--text-primary)}

    /* MODAL + PLAYER */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.95);display:none;justify-content:center;align-items:center;z-index:2000;padding:16px;overflow-y:auto}
    .modal.active{display:flex}
    .modal-content{background:var(--card-bg);width:min(1200px,96vw);border-radius:16px;box-shadow:var(--shadow-lg);overflow:hidden}
    .modal-close{position:absolute;top:16px;right:16px;background:rgba(0,0,0,.8);color:#fff;width:44px;height:44px;border-radius:50%;border:none;font-size:22px;cursor:pointer;z-index:10}
    .modal-close:hover{background:var(--accent-red)}
    .video-player{position:relative;width:100%;background:#000;aspect-ratio:16/9}
    .video-player iframe{position:absolute;inset:0;width:100%;height:100%;border:0;display:block}
    .fullscreen-btn{position:absolute;bottom:14px;right:14px;background:rgba(229,9,20,.9);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:800;z-index:100}
    .player-controls{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(transparent,rgba(0,0,0,.9));padding:14px;display:flex;gap:10px;align-items:center;opacity:0;transition:opacity .2s}
    .video-player:hover .player-controls{opacity:1}
    .control-btn{background:rgba(255,255,255,.2);border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .control-btn:active{transform:scale(.98)}
    .next-episode-overlay{position:absolute;inset:0;margin:auto;max-width:420px;height:max-content;background:rgba(0,0,0,.92);padding:24px;border-radius:14px;text-align:center;display:none}
    .next-episode-overlay.show{display:block}
    .countdown{font-size:42px;font-weight:900;color:var(--accent-red);margin:12px 0}
    .modal-body{padding: clamp(16px, 3vw, 40px);}

    /* FOOTER */
    .footer{background:var(--secondary-bg);padding:60px var(--container-pad) calc(30px + var(--safe-bottom));margin-top:80px;border-top:1px solid var(--border-color)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RESPONSIVE BREAKPOINTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media (max-width:1200px){ :root{ --card-min: 220px; } }
    @media (max-width:992px){ :root{ --card-min: 200px; } .search-bar{width:min(52vw,300px)} }
    @media (max-width:768px){
      :root{ --card-min: 150px; }
      .navbar{flex-wrap:wrap;gap:10px}
      .nav-links{display:none;flex-direction:column;gap:6px;width:100%}
      .nav-links.open{display:flex}
      .nav-toggle{display:flex}
      .navbar-right{margin-left:auto}
      .search-bar{width:min(70vw,420px)}
      .hero-content{position:relative;inset:auto;padding:14px}
      .hero-buttons .btn{padding:10px 16px}
      .modal-content{width:96vw;border-radius:12px}
      .modal-close{top:10px;right:10px;width:40px;height:40px;font-size:20px}
    }
    @media (max-width:480px){ :root{ --card-min: 140px; } .logo-text{font-size:16px} .movie-title{font-size:14px} }
    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important;scroll-behavior:auto!important}
    }
  </style>
</head>
<body>
  <!-- Loading -->
  <div class="loading-screen" id="loadingScreen" aria-live="polite" aria-busy="true">
    <img src="logo.jpg" alt="Modern Fact Stories Logo" class="loading-logo" decoding="async" />
    <div class="loading-ring" role="status" aria-label="Loading"></div>
    <p class="loading-text">Warming up your stream‚Ä¶</p>
  </div>

  <!-- NAVBAR -->
  <nav class="navbar" role="navigation" aria-label="Primary">
    <div class="navbar-left">
      <a class="logo" href="#" aria-label="Go to home">
        <img src="logo.jpg" alt="MFS Logo" class="logo-img" decoding="async" fetchpriority="high" />
        <span class="logo-text">MODERN FACT STORIES</span>
      </a>
      <button class="nav-toggle" id="navToggle" aria-label="Menu"><span></span></button>
      <div class="nav-links" id="navLinks">
        <a href="#" class="active" onclick="showAllSections()">Home</a>
        <a href="#continue-watching">Continue Watching</a>
        <a href="#trending">Trending</a>
        <a href="#favorites">My List</a>
      </div>
    </div>
    <div class="navbar-right">
      <div class="search-container">
        <input type="text" class="search-bar" placeholder="Search movies..." id="navSearch" aria-label="Search movies" />
        <button class="search-clear" id="searchClear" onclick="clearSearch()" aria-label="Clear search">√ó</button>
      </div>
      <button class="theme-toggle" id="themeToggle" title="Toggle theme" aria-label="Toggle dark mode">üåô</button>
      <div class="user-profile" title="Profile" aria-hidden="true">U</div>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero" id="heroBanner">
    <div class="hero-inner">
      <div id="heroMedia" class="hero-media" role="img" aria-label="Featured banner"></div>
      <div class="hero-content">
        <span class="hero-badge">‚ö° Featured</span>
        <h1 id="heroTitle">Discover Amazing Stories</h1>
        <p id="heroDesc">Stream unlimited entertainment</p>
        <div class="hero-buttons">
          <button class="btn btn-primary" onclick="openHeroMovie()">‚ñ∂Ô∏è Play</button>
          <button class="btn btn-secondary" onclick="toggleFavoriteHero()">‚ù§Ô∏è My List</button>
        </div>
      </div>
    </div>
  </section>

  <!-- RESUME (boosts retention & viewability) -->
  <section class="section" id="resume-section" style="display:none;">
    <div class="section-header">
      <div class="section-title">‚è≠Ô∏è Continue where you left off</div>
    </div>
    <div id="resumeCardWrap"></div>
  </section>

  <!-- SEARCH RESULTS -->
  <section class="section" id="search-results" style="display:none;">
    <div class="section-header">
      <div class="section-title">üîç Search Results</div>
    </div>
    <div class="movie-grid" id="searchGrid"></div>
  </section>

  <!-- CONTINUE WATCHING -->
  <section class="section" id="continue-watching" style="display:none;">
    <div class="section-header">
      <div class="section-title">‚ñ∂Ô∏è Continue Watching</div>
    </div>
    <div class="movie-grid" id="continueGrid"></div>
  </section>

  <!-- TRENDING -->
  <section class="section" id="trending">
    <div class="section-header">
      <div class="section-title">üî• Trending Now</div>
    </div>
    <div class="movie-grid" id="trendingGrid">
      <!-- skeletons -->
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
    </div>
  </section>

  <!-- POPULAR -->
  <section class="section" id="popular-section">
    <div class="section-header">
      <div class="section-title">‚≠ê Popular Movies</div>
    </div>
    <div class="movie-grid" id="popularGrid">
      <!-- skeletons -->
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
      <div class="skeleton"><div class="sk-poster"></div><div class="sk-text"><div class="sk-bar"></div></div></div>
    </div>
  </section>

  <!-- RECOMMENDED -->
  <section class="section" id="recommended-section">
    <div class="section-header">
      <div class="section-title">üì∫ Recommended For You</div>
    </div>
    <div class="movie-grid" id="recommendedGrid"></div>
  </section>

  <!-- FAVORITES -->
  <section class="section" id="favorites">
    <div class="section-header">
      <div class="section-title">‚ù§Ô∏è My List</div>
    </div>
    <div class="movie-grid" id="favoritesGrid">
      <p style="grid-column: 1/-1; text-align: center; padding: 40px;">Add movies to your list!</p>
    </div>
  </section>

  <!-- MODAL -->
  <div class="modal" id="movieModal" aria-modal="true" role="dialog" aria-label="Video player modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()" aria-label="Close">√ó</button>
      <div class="video-player">
        <iframe id="videoPlayer" src="" allowfullscreen allow="autoplay; fullscreen; picture-in-picture"></iframe>
        <button class="fullscreen-btn" onclick="toggleFullscreen()" title="Fullscreen">‚õ∂ Fullscreen</button>
        <div class="next-episode-overlay" id="nextEpisodeOverlay">
          <h2>Next Episode Starting In</h2>
          <div class="countdown" id="countdown">10</div>
          <button class="btn btn-primary" onclick="playNextEpisode()">‚ñ∂Ô∏è Play Now</button>
          <button class="btn btn-secondary" onclick="cancelAutoplay()">‚úï Cancel</button>
        </div>
        <div class="player-controls" aria-hidden="true">
          <button class="control-btn" onclick="skipBackward()">‚è™ 10s</button>
          <button class="control-btn" id="playPauseBtn">‚ñ∂Ô∏è Play</button>
          <button class="control-btn" onclick="skipForward()">10s ‚è©</button>
          <button class="control-btn" onclick="changePlaybackSpeed()">Speed: <span id="speedIndicator">1x</span></button>
          <button class="control-btn" onclick="togglePIP()">üì∫ PiP</button>
        </div>
      </div>
      <div class="modal-body">
        <h1 id="modalTitle" style="font-size: 1.6rem; margin-bottom: 14px;">Movie Title</h1>
        <p id="modalDescription" style="line-height: 1.8; color: var(--text-secondary); margin-bottom: 22px;">Description</p>
        <div id="episodeSection" style="display:none; margin-bottom: 20px;">
          <h3 style="margin-bottom: 12px;">Episodes</h3>
          <div id="episodeGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px;"></div>
        </div>
        <div style="margin-top: 16px;">
          <h3 style="margin-bottom: 12px;">Servers (Auto-selected, Ad-blocked)</h3>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="selectServer(1)" id="server1">Server 1</button>
            <button class="btn btn-secondary" onclick="selectServer(2)" id="server2">Server 2</button>
            <button class="btn btn-secondary" onclick="selectServer(3)" id="server3">Server 3</button>
            <button class="btn btn-secondary" onclick="selectServer(4)" id="server4">Server 4</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div style="text-align: center; padding: 20px; background: var(--secondary-bg); border-radius: 12px; border: 2px solid var(--accent-red); margin-bottom: 30px;">
      <h4 style="color: var(--accent-red); margin-bottom: 15px;">‚ö†Ô∏è DMCA & Copyright Notice</h4>
      <p style="color: var(--text-secondary); margin-bottom: 10px;">This website does not host copyrighted content. Videos embedded from third-party sources.</p>
      <p style="color: var(--accent-red); font-weight: 700;">üìß Contact: <a href="mailto:rollonrenren@gmail.com" style="color: var(--accent-red);">rollonrenren@gmail.com</a></p>
    </div>
    <p style="text-align: center; color: var(--text-muted);">&copy; 2025 Modern Fact Stories. Powered by TMDb API.</p>
  </footer>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ POPUNDER (vendor code) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script type="text/javascript" data-cfasync="false" src="//idolinflectiongentlemen.com/dd/ab/32/ddab327f0fbb76e82d98d4e508c16a85.js"></script>

  <!-- Main App (deferred for faster paint) -->
  <script defer>
  /* Polyfill-ish for requestIdleCallback */
  window.requestIdleCallback ||= (cb)=>setTimeout(()=>cb({timeRemaining:()=>0,didTimeout:true}), 1);

  /* Safe storage helpers */
  const safeStorage = {
    get(key, fallback){
      try{ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }catch{ return fallback; }
    },
    set(key, value){
      try{ localStorage.setItem(key, JSON.stringify(value)); }catch{}
    }
  };

  /* NAV: mobile toggle */
  document.addEventListener('click', (e)=>{
    const btn = document.getElementById('navToggle');
    const links = document.getElementById('navLinks');
    if (!btn || !links) return;
    if (e.target === btn || btn.contains(e.target)){
      links.classList.toggle('open');
    } else {
      if (window.innerWidth <= 768 && !links.contains(e.target)) links.classList.remove('open');
    }
  });

  /* TMDb + App logic (with improved resilience) */
  const TMDB_API_KEY = 'f27081ffd1178848ff5106836b2adc93'; // note: public on client; rotate if scraped
  const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
  const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p';

  const GENRE_MAP = {28:'Action',12:'Adventure',16:'Animation',35:'Comedy',80:'Crime',99:'Documentary',18:'Drama',10751:'Family',14:'Fantasy',36:'History',27:'Horror',10402:'Music',9648:'Mystery',10749:'Romance',878:'Sci-Fi',10770:'TV Movie',53:'Thriller',10752:'War',37:'Western'};

  const SERVERS = [
    {name:'VidSrc', url:'https://vidsrc.xyz/embed'},
    {name:'VidSrc Pro', url:'https://vidsrc.pro/embed'},
    {name:'2Embed', url:'https://www.2embed.cc/embed'},
    {name:'SuperEmbed', url:'https://multiembed.mov/directstream.php?video_id'}
  ];

  let favorites = safeStorage.get('favorites', []);
  let continueWatching = safeStorage.get('continueWatching', []);
  let watchHistory = safeStorage.get('watchHistory', []);
  let currentMovie = null;
  let currentServerIndex = 0;
  let autoplayTimer = null;
  let currentSpeed = 1.0;
  let heroMovieId = null;
  let searchTimeout = null;
  let lastSearchAbort = null;

  const searchInput = document.getElementById('navSearch');
  const searchClear = document.getElementById('searchClear');

  function preloadHero(url){
    if (!url) return Promise.resolve();
    return new Promise((res)=>{
      const img = new Image();
      img.onload = res; img.onerror = res;
      img.src = url.includes('/original') ? url.replace('/original','/w1280') : url;
    });
  }

  function setHeroBackground(url){
    const media = document.getElementById('heroMedia');
    const best = url && url.includes('/original') ? url.replace('/original','/w1280') : url;
    media.style.backgroundImage = best ? `url('${best}')` : '';
  }

  // fetch with timeout + retries
  async function fetchTMDb(endpoint, params = {}, {retries=1, timeoutMs=9000} = {}){
    const url = new URL(`${TMDB_BASE_URL}${endpoint}`);
    url.searchParams.append('api_key', TMDB_API_KEY);
    url.searchParams.append('language', 'en-US');
    Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));

    for (let attempt=0; attempt<=retries; attempt++){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), timeoutMs);
      try{
        const res = await fetch(url, {signal: ctrl.signal});
        clearTimeout(t);
        if (!res.ok) throw new Error('HTTP '+res.status);
        return await res.json();
      }catch(err){
        clearTimeout(t);
        if (attempt === retries) { console.warn('TMDb error:', err.message||err); return {results: []}; }
        await new Promise(r=>setTimeout(r, 400*(attempt+1)));
      }
    }
  }

  function convertMovie(item, isTV=false){
    return {
      id: item.id,
      title: isTV ? item.name : item.title,
      year: isTV ? (item.first_air_date ? new Date(item.first_air_date).getFullYear() : '') : (item.release_date ? new Date(item.release_date).getFullYear() : ''),
      rating: item.vote_average ? item.vote_average.toFixed(1) : '‚Äî',
      genres: item.genre_ids ? item.genre_ids.map(id => GENRE_MAP[id] || 'Unknown').slice(0,3) : [],
      description: item.overview || 'No description available.',
      poster: item.poster_path ? `${TMDB_IMAGE_BASE}/w500${item.poster_path}` : '',
      backdrop: item.backdrop_path ? `${TMDB_IMAGE_BASE}/original${item.backdrop_path}` : '',
      poster_path: item.poster_path || '',
      quality: item.vote_average >= 8 ? '4K' : 'HD',
      type: isTV ? 'tv' : 'movie'
    };
  }

  function createMovieCard(movie){
    const card = document.createElement('div');
    card.className = 'movie-card';
    card.onclick = () => openModal(movie.id, movie.type);

    const isFavorite = favorites.some(f => f.id === movie.id && f.type === movie.type);
    const progress = getContinueProgress(movie.id, movie.type);
    const FALLBACK = 'https://via.placeholder.com/600x900?text=No+Image';

    card.innerHTML = `
      <div class="quality-badge">${movie.quality}</div>
      <div class="poster-wrap">
        <img
          class="movie-poster"
          src="${movie.poster || FALLBACK}"
          alt="${movie.title}"
          loading="lazy"
          decoding="async"
          referrerpolicy="no-referrer"
          onerror="this.onerror=null; this.src='${FALLBACK}';"
        >
      </div>
      <button class="action-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite(${movie.id}, '${movie.type}', event)">${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}</button>
      <div class="movie-info">
        <div class="movie-title">${movie.title}</div>
        <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:13px;">
          <span style="color:var(--text-muted);">${movie.year || ''}</span>
          <span style="color:var(--accent-gold);">${movie.rating==='‚Äî'?'':'‚≠ê '+movie.rating}</span>
        </div>
        ${progress > 0 ? `<div class="movie-progress"><div class="movie-progress-bar" style="width:${progress}%"></div></div>` : ''}
      </div>
    `;
    return card;
  }

  function getContinueProgress(id, type){
    const item = continueWatching.find(w => w.id === id && w.type === type);
    return item ? item.progress : 0;
  }

  function updateContinueWatching(id, type, progress, title){
    const i = continueWatching.findIndex(w => w.id === id && w.type === type);
    const rec = {id, type, progress, title, timestamp: Date.now()};
    if (i > -1) continueWatching[i] = rec; else continueWatching.unshift(rec);
    if (continueWatching.length > 20) continueWatching = continueWatching.slice(0,20);
    safeStorage.set('continueWatching', continueWatching);
    loadContinueWatching();
  }

  async function loadContinueWatching(){
    const section = document.getElementById('continue-watching');
    const grid = document.getElementById('continueGrid');
    if (!continueWatching.length){ section.style.display='none'; return; }
    section.style.display='block'; grid.innerHTML = '';
    for (const item of continueWatching) {
      const data = await fetchTMDb(`/${item.type}/${item.id}`);
      if (data && data.id) grid.appendChild(createMovieCard(convertMovie(data, item.type === 'tv')));
    }
  }

  function loadMovieGrid(gridId, movies){
    const grid = document.getElementById(gridId);
    grid.innerHTML = '';
    movies.forEach(movie => grid.appendChild(createMovieCard(movie)));
  }

  async function loadTrending(){
    const data = await fetchTMDb('/trending/movie/week', {}, {retries:1});
    const movies = (data.results||[]).map(item => convertMovie(item,false));
    loadMovieGrid('trendingGrid', movies);
    if (movies.length) {
      const hero = movies[0];
      heroMovieId = {id: hero.id, type: 'movie'};
      await preloadHero(hero.backdrop);
      setHeroBackground(hero.backdrop);
      document.getElementById('heroTitle').textContent = hero.title;
      document.getElementById('heroDesc').textContent = hero.description;
    }
  }

  async function loadPopular(){
    const data = await fetchTMDb('/movie/popular', {}, {retries:1});
    const movies = (data.results||[]).map(item => convertMovie(item,false));
    loadMovieGrid('popularGrid', movies);
  }

  async function loadRecommended(){
    if (!watchHistory.length) return;
    const last = watchHistory[0];
    const data = await fetchTMDb(`/${last.type}/${last.id}/recommendations`);
    const movies = (data.results||[]).map(item => convertMovie(item, last.type === 'tv')).slice(0,10);
    if (movies.length) loadMovieGrid('recommendedGrid', movies);
  }

  async function loadFavorites(){
    const grid = document.getElementById('favoritesGrid');
    if (!favorites.length){
      grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 40px;">Add movies to your list!</p>';
      return;
    }
    grid.innerHTML = '';
    for (const fav of favorites){
      const data = await fetchTMDb(`/${fav.type}/${fav.id}`);
      if (data && data.id) grid.appendChild(createMovieCard(convertMovie(data, fav.type === 'tv')));
    }
  }

  // Resume section render
  function renderResume(){
    const wrap=document.getElementById('resumeCardWrap');
    const sec=document.getElementById('resume-section');
    const hist = (watchHistory||[])[0];
    if (!hist){ sec.style.display='none'; return; }
    sec.style.display='block';
    const poster = hist.posterPath ? `https://image.tmdb.org/t/p/w500${hist.posterPath}` : 'https://via.placeholder.com/600x900?text=Resume';
    wrap.innerHTML = `
      <div class="movie-card" style="max-width:420px" onclick="openModal(${hist.id}, '${hist.type}')">
        <div class="poster-wrap"><img class="movie-poster" src="${poster}" alt="${hist.title||'Resume'}" loading="lazy"></div>
        <div class="movie-info"><div class="movie-title">${hist.title}</div></div>
      </div>`;
  }

  async function openModal(id, type){
    // POPUNDER trigger if vendor exposes _pu()
    if (typeof window._pu === 'function') { window._pu(); }
    track('open_modal', {id, type});

    const data = await fetchTMDb(`/${type}/${id}`);
    currentMovie = {
      id: data.id,
      title: type === 'tv' ? data.name : data.title,
      description: data.overview || 'No description.',
      type,
      posterPath: data.poster_path || ''
    };

    document.getElementById('modalTitle').textContent = currentMovie.title;
    document.getElementById('modalDescription').textContent = currentMovie.description;
    document.getElementById('episodeSection').style.display = 'none';

    selectServer(1);
    document.getElementById('movieModal').classList.add('active');
    document.body.style.overflow = 'hidden';

    addToWatchHistory(id, type, currentMovie.title, currentMovie.posterPath);
    updateContinueWatching(id, type, 10, currentMovie.title);
  }

  function selectServer(serverNum){
    currentServerIndex = serverNum - 1;
    const server = SERVERS[currentServerIndex];
    document.querySelectorAll('[id^="server"]').forEach((btn, i) => {
      btn.className = i === currentServerIndex ? 'btn btn-primary' : 'btn btn-secondary';
    });

    let embedUrl = '';
    if (currentMovie.type === 'movie') embedUrl = `${server.url}/movie/${currentMovie.id}`;
    else embedUrl = `${server.url}/tv/${currentMovie.id}/1/1`;

    const iframe = document.getElementById('videoPlayer');
    iframe.src = embedUrl;
  }

  function closeModal(){
    document.getElementById('movieModal').classList.remove('active');
    document.getElementById('videoPlayer').src = '';
    document.body.style.overflow = 'auto';
    if (autoplayTimer) clearTimeout(autoplayTimer);
  }

  function toggleFavorite(id, type, event){
    event.stopPropagation();
    const index = favorites.findIndex(f => f.id === id && f.type === type);
    if (index > -1) favorites.splice(index,1); else favorites.push({id, type});
    safeStorage.set('favorites', favorites);
    loadFavorites();
  }

  function openHeroMovie(){ if (heroMovieId) openModal(heroMovieId.id, heroMovieId.type); }
  function toggleFavoriteHero(){
    if (!heroMovieId) return;
    const index = favorites.findIndex(f => f.id === heroMovieId.id && f.type === heroMovieId.type);
    if (index > -1) favorites.splice(index, 1);
    else favorites.push({id: heroMovieId.id, type: heroMovieId.type});
    safeStorage.set('favorites', favorites);
    loadFavorites();
  }

  function addToWatchHistory(id, type, title, posterPath){
    const i = watchHistory.findIndex(w => w.id === id && w.type === type);
    if (i>-1) watchHistory.splice(i,1);
    watchHistory.unshift({id, type, title, posterPath: posterPath||'', timestamp: Date.now()});
    if (watchHistory.length > 50) watchHistory = watchHistory.slice(0,50);
    safeStorage.set('watchHistory', watchHistory);
    renderResume();
    loadRecommended();
  }

  function skipBackward(){ try{ document.getElementById('videoPlayer').contentWindow.postMessage({action:'seek',time:-10}, '*'); }catch{} }
  function skipForward(){ try{ document.getElementById('videoPlayer').contentWindow.postMessage({action:'seek',time:10}, '*'); }catch{} }
  function changePlaybackSpeed(){
    const speeds = [0.5,0.75,1.0,1.25,1.5,2.0];
    const currentIndex = speeds.indexOf(currentSpeed);
    currentSpeed = speeds[(currentIndex + 1) % speeds.length];
    document.getElementById('speedIndicator').textContent = currentSpeed + 'x';
    try{ document.getElementById('videoPlayer').contentWindow.postMessage({action:'speed',value:currentSpeed}, '*'); }catch{}
  }
  function togglePIP(){
    try{
      const iframe = document.getElementById('videoPlayer');
      if (document.pictureInPictureElement) document.exitPictureInPicture();
      else iframe.requestPictureInPicture?.();
    }catch{ alert('Picture-in-Picture not supported'); }
  }
  function toggleFullscreen(){
    const player = document.querySelector('.video-player');
    if (!document.fullscreenElement) player.requestFullscreen?.(); else document.exitFullscreen?.();
  }

  document.getElementById('themeToggle').addEventListener('click', () => {
    const html = document.documentElement;
    if (html.hasAttribute('data-theme')) { html.removeAttribute('data-theme'); document.getElementById('themeToggle').textContent = 'üåô'; }
    else { html.setAttribute('data-theme', 'dark'); document.getElementById('themeToggle').textContent = '‚òÄÔ∏è'; }
  });

  // Search (debounced + abortable)
  function doSearchNow(q){
    return (async ()=>{
      const searchSection = document.getElementById('search-results');
      const searchGrid = document.getElementById('searchGrid');
      document.getElementById('trending').style.display = 'none';
      document.getElementById('popular-section').style.display = 'none';
      document.getElementById('recommended-section').style.display = 'none';
      document.getElementById('heroBanner').style.display = 'block';

      searchSection.style.display = 'block';
      searchGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;">üîç Searching...</div>';

      try{
        if (lastSearchAbort) lastSearchAbort.abort();
        lastSearchAbort = new AbortController();
        const url = new URL('https://api.themoviedb.org/3/search/multi');
        url.searchParams.set('api_key', TMDB_API_KEY);
        url.searchParams.set('language', 'en-US');
        url.searchParams.set('query', q);
        url.searchParams.set('page', '1');
        const res = await fetch(url, {signal: lastSearchAbort.signal});
        const data = await res.json();
        const results = (data.results||[]).filter(i => i.media_type==='movie' || i.media_type==='tv');
        const movies = results.map(item => convertMovie(item, item.media_type === 'tv'));
        track('search', {q});
        if (movies.length) loadMovieGrid('searchGrid', movies);
        else showNoResults(q);
      }catch(err){
        if (err.name==='AbortError') return;
        searchGrid.innerHTML = '<div class="no-results"><h3>‚ùå Search Error</h3><p>Unable to search. Please try again.</p></div>';
      }
    })();
  }

  searchInput?.addEventListener('input', (e) => {
    const query = e.target.value.trim();
    if (query.length > 0) {
      searchClear.style.display = 'block';
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(()=>doSearchNow(query), 400);
    } else {
      searchClear.style.display = 'none';
      clearSearch();
    }
  });
  searchInput?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      const query = searchInput.value.trim();
      if (query) { clearTimeout(searchTimeout); doSearchNow(query); }
    }
  });

  function showNoResults(query){
    const searchGrid = document.getElementById('searchGrid');
    searchGrid.innerHTML = `
      <div class="no-results">
        <h3>üòï No Results Found</h3>
        <p>No movies or TV shows found for "<strong>${query.replace(/[<>&]/g,'')}</strong>"</p>
        <p style="margin-top:10px">Try different keywords</p>
      </div>
    `;
  }

  function clearSearch(){
    searchInput.value = '';
    searchClear.style.display = 'none';
    showAllSections();
  }

  function showAllSections(){
    document.getElementById('search-results').style.display = 'none';
    document.getElementById('trending').style.display = 'block';
    document.getElementById('popular-section').style.display = 'block';
    document.getElementById('recommended-section').style.display = 'block';
    document.getElementById('heroBanner').style.display = 'block';
  }

  async function init(){
    // Stopgap: hide loader after 3.5s max, even on slow networks
    const loader = document.getElementById('loadingScreen');
    const loaderFailSafe = setTimeout(()=> loader.classList.add('hidden'), 3500);

    await Promise.all([
      loadTrending(),
      loadPopular(),
      loadContinueWatching(),
      loadFavorites(),
      loadRecommended()
    ]);

    // little idle delay so images settle
    requestIdleCallback(()=>{ loader.classList.add('hidden'); clearTimeout(loaderFailSafe); }, {timeout: 1000});

    // Render resume CTA
    renderResume();
  }
  window.addEventListener('load', init);

  // PWA SW registration
  if ('serviceWorker' in navigator){
    window.addEventListener('load', ()=> {
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    });
  }
  </script>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  NATIVE BANNER (vendor + logic)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <style>
    /* Inline native (desktop/tablet) */
    .native-inline-wrap{max-width:1100px;margin:24px auto;padding:0 var(--container-pad);display:none}
    .native-inline-card{background:var(--card-bg);border:1px solid var(--border-color);border-radius:14px;box-shadow:var(--shadow-sm);overflow:hidden}
    .native-inline-head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--secondary-bg);border-bottom:1px solid var(--border-color)}
    .native-inline-head b{font-size:14px}
    .native-inline-close{background:transparent;border:0;font-size:18px;cursor:pointer;opacity:.7}
    .native-inline-body{padding:8px}
    .native-divider{max-width:1100px;margin:28px auto 12px;padding:0 var(--container-pad);color:var(--text-secondary);font-weight:800;letter-spacing:.2px;text-transform:uppercase;font-size:12px}

    /* Sticky native (mobile) */
    .native-sticky{position:sticky;bottom:0;left:0;right:0;z-index:1500;background:var(--card-bg);border-top:1px solid var(--border-color);padding:8px 10px calc(8px + var(--safe-bottom));box-shadow:0 -8px 24px rgba(0,0,0,.15);display:none}
    .native-sticky-inner{display:flex;align-items:center;gap:10px}
    .native-sticky-title{font-weight:800;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .native-sticky-actions{margin-left:auto;display:flex;gap:8px}
    .native-sticky-btn{background:var(--accent-red);color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
    .native-sticky-close{background:transparent;border:0;font-size:18px;cursor:pointer;opacity:.7}
    @media (max-width:768px){.native-inline-wrap{display:none}.native-sticky{display:block}}
    @media (min-width:769px){.native-sticky{display:none}}
  </style>

  <!-- Desktop/Tablet Inline Anchor -->
  <div id="native-inline-anchor" class="native-inline-wrap" aria-hidden="true">
    <div class="native-divider">You might also like</div>
    <div class="native-inline-card">
      <div class="native-inline-head">
        <b>Recommended</b>
        <button class="native-inline-close" type="button" aria-label="Close" onclick="window.__nativeAd?.dismiss('inline')">‚úï</button>
      </div>
      <div class="native-inline-body">
        <!-- Vendor container will be assigned here on desktop -->
        <div id="mfsp_vendor_slot_inline"></div>
      </div>
    </div>
  </div>

  <!-- Mobile Sticky Anchor -->
  <div id="native-sticky-anchor" class="native-sticky" aria-hidden="true">
    <div class="native-sticky-inner">
      <div class="native-sticky-title">Trending picks for you</div>
      <div class="native-sticky-actions">
        <button class="native-sticky-btn" type="button" onclick="window.__nativeAd?.cta()">Open</button>
        <button class="native-sticky-close" type="button" aria-label="Close" onclick="window.__nativeAd?.dismiss('sticky')">‚úï</button>
      </div>
    </div>
    <div style="margin-top:8px;">
      <!-- Vendor container will be assigned here on mobile -->
      <div id="mfsp_vendor_slot_mobile"></div>
    </div>
  </div>

  <!-- Load vendor ONCE -->
  <script async data-cfasync="false" src="//idolinflectiongentlemen.com/a4bf814c4146624bf8b42bd02f5c6d3c/invoke.js"></script>

  <!-- Caps + native init -->
  <script>
  // Simple caps & cooldown for native
  (function(){
    const CAP_KEY="mfs_native_cap";
    const DAY=()=>new Date().toISOString().slice(0,10);
    function get(){ try{return JSON.parse(localStorage.getItem(CAP_KEY))||{day:DAY(),count:0,last:0}; }catch{return {day:DAY(),count:0,last:0};}}
    function set(v){ try{localStorage.setItem(CAP_KEY,JSON.stringify(v));}catch{} }
    window.__nativeAdCap = {
      canShow(cooldownMs=120000, maxPerDay=4){
        const now=Date.now(); const cap=get();
        if (cap.day!==DAY()) {cap.day=DAY(); cap.count=0;}
        if (now-(cap.last||0) < cooldownMs) return false;
        if ((cap.count||0) >= maxPerDay) return false;
        return true;
      },
      markShown(){ const cap=get(); cap.day=DAY(); cap.count=(cap.count||0)+1; cap.last=Date.now(); set(cap); }
    };
  })();

  (function(){
    const VENDOR_ID = "container-a4bf814c4146624bf8b42bd02f5c6d3c"; // must exist on exactly one visible element
    const startAt = Date.now();

    // UA+pointer check
    const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent||"") ||
                     (window.matchMedia && window.matchMedia("(pointer:coarse)").matches);

    const inlineAnchor = document.getElementById("native-inline-anchor");
    const stickyAnchor = document.getElementById("native-sticky-anchor");
    const inlineSlot   = document.getElementById("mfsp_vendor_slot_inline");
    const mobileSlot   = document.getElementById("mfsp_vendor_slot_mobile");

    function assignVendorIdTo(el){
      [inlineSlot, mobileSlot].forEach(n => { if (n && n.id === VENDOR_ID) n.id = (n===inlineSlot?"mfsp_vendor_slot_inline":"mfsp_vendor_slot_mobile"); });
      if (el && el.id !== VENDOR_ID) el.id = VENDOR_ID;
    }

    function showInline(){
      if (!inlineAnchor) return;
      const popular = document.getElementById("popular-section");
      const footer = document.querySelector("footer") || document.body;
      (popular && popular.parentNode)
        ? popular.parentNode.insertBefore(inlineAnchor, popular.nextSibling)
        : document.body.insertBefore(inlineAnchor, footer);
      assignVendorIdTo(inlineSlot);
      inlineAnchor.style.display = "block";
      inlineAnchor.setAttribute('aria-hidden','false');
      track('native_shown',{placement:'inline'});
    }

    function showSticky(){
      if (!stickyAnchor) return;
      const footer = document.querySelector("footer") || document.body;
      footer.parentNode.insertBefore(stickyAnchor, footer);
      assignVendorIdTo(mobileSlot);
      stickyAnchor.style.display = "block";
      stickyAnchor.setAttribute('aria-hidden','false');
      track('native_shown',{placement:'sticky'});
    }

    // public helpers
    window.__nativeAd = {
      dismiss(where){
        if (where==='inline'){
          if (inlineAnchor){ inlineAnchor.style.display="none"; inlineAnchor.setAttribute('aria-hidden','true'); }
        } else {
          if (stickyAnchor){ stickyAnchor.style.display="none"; stickyAnchor.setAttribute('aria-hidden','true'); }
        }
      },
      cta(){ /* optional: hook for analytics */ }
    };

    function initNative(){
      const dwell = isMobile ? 800 : 600;
      if ((Date.now()-startAt) < dwell) { setTimeout(initNative, 200); return; }

      if (!window.__nativeAdCap?.canShow(120000, 4)) return; // 2min cooldown, 4/day

      if (isMobile){
        showSticky();
        window.__nativeAdCap.markShown();
      } else {
        // show when Popular scrolled into view for nicer integration
        const popular = document.getElementById("popular-section");
        if (!popular){ showInline(); window.__nativeAdCap.markShown(); return; }
        const io = new IntersectionObserver((entries)=>{
          entries.forEach(e=>{
            if (e.isIntersecting){
              showInline();
              window.__nativeAdCap.markShown();
              io.disconnect();
            }
          });
        },{ rootMargin:"0px 0px -33% 0px", threshold:0.01 });
        io.observe(popular);
      }
    }

    // hide sticky while modal is open (avoid overlap)
    const modal = document.getElementById("movieModal");
    if (modal){
      const mo = new MutationObserver(()=>{
        if (!stickyAnchor) return;
        const open = modal.classList.contains("active");
        stickyAnchor.style.visibility = open ? "hidden" : "visible";
      });
      mo.observe(modal, { attributes:true, attributeFilter:["class"] });
    }

    window.addEventListener('load', initNative);
  })();
  </script>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  END NATIVE  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

  <!-- QUICK NOTES:
       - Create /manifest.webmanifest with:
         {
           "name": "Modern Fact Stories",
           "short_name": "MFS",
           "start_url": "/",
           "display": "standalone",
           "background_color": "#0f0f0f",
           "theme_color": "#0f0f0f",
           "icons": [
             {"src": "/logo.jpg","sizes": "192x192","type":"image/jpeg"},
             {"src": "/logo.jpg","sizes": "512x512","type":"image/jpeg"}
           ]
         }
       - Create /sw.js with:
         self.addEventListener('install', e=>{
           e.waitUntil(caches.open('mfs-v1').then(c=>c.addAll(['/', '/logo.jpg'])));
         });
         self.addEventListener('fetch', e=>{
           e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request)));
         });
       - Set CSP via Cloudflare response headers (not meta) and whitelist required domains.
  -->
</body>
</html>
